(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ea9d758"],{"25b9":function(e,t,n){},"2cb5":function(e,t,n){"use strict";n("3006")},3006:function(e,t,n){},"78ee":function(e,t,n){"use strict";n("25b9")},edde:function(e,t,n){"use strict";n("fc73")},fc73:function(e,t,n){},ff4d:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-popover",{attrs:{"popper-class":"message-popover-class",placement:"bottom",width:"420",trigger:"hover","visible-arrow":!1,offset:-30},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticClass:"messageBox"},[e.data.length?n("div",{staticClass:"message-box-content"},[n("InfiniteScroll",{staticStyle:{padding:"0 10px"},attrs:{span:24,data:e.data,total:e.unReadNumber},on:{load:e.load},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return[n("div",{staticClass:"messageCard",on:{click:function(t){return e.messageCardClick(s)}}},[n("div",{staticClass:"card-title"},[n("span",[e._v(e._s(s.businessTypeName||"默认消息"))]),n("span",[e._v(e._s(s.createTime))])]),n("div",{staticClass:"card-body"},[s.isRead?e._e():n("i",{staticClass:"makeicon"}),e._v(" "+e._s(s.context)+" ")])])]}}],null,!1,1662854305)})],1):n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"},{name:"empty",rawName:"v-empty",value:e.data,expression:"data"}],staticClass:"empty"}),n("section",{staticClass:"messageFoot"},[n("ColorTextBtn",{directives:[{name:"p",rawName:"v-p",value:["externalbusiness:message:isRead"],expression:"['externalbusiness:message:isRead']"}],staticClass:"footbtn",attrs:{type:"info"},on:{click:e.clickAllRead}},[n("i",{staticClass:"iconfont icon-shejiqi_qingkong readClass"}),e._v(" "),n("span",{staticStyle:{color:"#86909C"}},[e._v("全部已读")])]),n("ColorTextBtn",{directives:[{name:"p",rawName:"v-p",value:["externalbusiness:message:allMessage"],expression:"['externalbusiness:message:allMessage']"}],staticClass:"footbtn",on:{click:e.clickAllMessage}},[e._v("全部消息 "),n("i",{staticClass:"el-icon-arrow-right"})])],1)]),n("el-badge",{class:{customBadgeClass:e.unReadNumber>9},attrs:{slot:"reference",value:e.unReadNumber,max:99,hidden:!e.unReadNumber},slot:"reference"},[n("div",{staticClass:"notice-icon"},[n("svg-icon",{attrs:{"icon-class":"ic_message"}})],1)])],1)},o=[],i=n("1da1"),r=n("5530"),a=(n("96cf"),n("d81d"),n("4de4"),n("d3b7"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"infinite-component-list-wrapper"},[n("el-row",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.load,expression:"load"}],ref:"scrollEle",staticClass:"list",attrs:{gutter:e.gutter,"infinite-scroll-disabled":"disabled","infinite-scroll-distance":20}},[e._l(e.data,(function(t,s){return n("el-col",{key:t.id?t.id+"_"+s:s,attrs:{span:e.span}},[e._t("default",null,{data:t})],2)})),e.isShowLoading?n("el-col",{attrs:{span:24}},[e.noMore&&e.data.length?n("p",[e._v("没有更多了")]):e._e(),e.loading?n("p",[e._v("加载中...")]):e._e()]):e._e()],2)],1)}),c=[],u=(n("a9e3"),n("52be")),l={props:{data:{type:Array,default:function(){return[]}},total:{type:Number,required:!0},gutter:{type:Number,default:5},span:{type:Number,default:8},isShowLoading:{default:!0},isLoadForScroll:Boolean},data:function(){return{loading:!1}},watch:{data:function(e,t){var n=this;this.loading=!1,this.isLoadForScroll&&this.$nextTick((function(){(null===e||void 0===e?void 0:e.length)===(null===t||void 0===t?void 0:t.length)||Object(u["a"])(n.$refs.scrollEle)||n.load()}))}},computed:{noMore:function(){var e=this.data.length>=this.total;return e&&(this.loading=!1),e},disabled:function(){return this.loading||this.noMore}},methods:{load:function(){this.loading=!0,this.$emit("load")}}},d=l,h=(n("78ee"),n("2877")),f=Object(h["a"])(d,a,c,!1,null,"5d93adea",null),p=f.exports,_=(n("ac1f"),n("5319"),n("00b4"),n("99af"),n("a15b"),function(e,t){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},_(e,t)});function b(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function m(e){var t="function"===typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}var g=function(){function e(e,t){this.target=t,this.type=e}return e}(),v=function(e){function t(t,n){var s=e.call(this,"error",n)||this;return s.message=t.message,s.error=t,s}return b(t,e),t}(g),y=function(e){function t(t,n,s){void 0===t&&(t=1e3),void 0===n&&(n="");var o=e.call(this,"close",s)||this;return o.wasClean=!0,o.code=t,o.reason=n,o}return b(t,e),t}(g),w=function(){if("undefined"!==typeof WebSocket)return WebSocket},k=function(e){return"undefined"!==typeof e&&!!e&&2===e.CLOSING},C={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},O=function(){function e(e,t,n){var s=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(e){s._debug("open event");var t=s._options.minUptime,n=void 0===t?C.minUptime:t;clearTimeout(s._connectTimeout),s._uptimeTimeout=setTimeout((function(){return s._acceptOpen()}),n),s._ws.binaryType=s._binaryType,s._messageQueue.forEach((function(e){return s._ws.send(e)})),s._messageQueue=[],s.onopen&&s.onopen(e),s._listeners.open.forEach((function(t){return s._callEventListener(e,t)}))},this._handleMessage=function(e){s._debug("message event"),s.onmessage&&s.onmessage(e),s._listeners.message.forEach((function(t){return s._callEventListener(e,t)}))},this._handleError=function(e){s._debug("error event",e.message),s._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),s.onerror&&s.onerror(e),s._debug("exec error listeners"),s._listeners.error.forEach((function(t){return s._callEventListener(e,t)})),s._connect()},this._handleClose=function(e){s._debug("close event"),s._clearTimeouts(),s._shouldReconnect&&s._connect(),s.onclose&&s.onclose(e),s._listeners.close.forEach((function(t){return s._callEventListener(e,t)}))},this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce((function(e,t){return"string"===typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e}),0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(e,t),this._connect()):this._connect()},e.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,n=void 0===t?C.maxEnqueuedMessages:t;this._messageQueue.length<n&&(this._debug("enqueue",e),this._messageQueue.push(e))}},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.dispatchEvent=function(e){var t,n,s=this._listeners[e.type];if(s)try{for(var o=m(s),i=o.next();!i.done;i=o.next()){var r=i.value;this._callEventListener(e,r)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter((function(e){return e!==t})))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug},e.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,n=void 0===t?C.reconnectionDelayGrowFactor:t,s=e.minReconnectionDelay,o=void 0===s?C.minReconnectionDelay:s,i=e.maxReconnectionDelay,r=void 0===i?C.maxReconnectionDelay:i,a=0;return this._retryCount>0&&(a=o*Math.pow(n,this._retryCount-1),a>r&&(a=r)),this._debug("next delay",a),a},e.prototype._wait=function(){var e=this;return new Promise((function(t){setTimeout(t,e._getNextDelay())}))},e.prototype._getNextUrl=function(e){if("string"===typeof e)return Promise.resolve(e);if("function"===typeof e){var t=e();if("string"===typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,s=void 0===n?C.maxRetries:n,o=t.connectionTimeout,i=void 0===o?C.connectionTimeout:o,r=t.WebSocket,a=void 0===r?w():r;if(this._retryCount>=s)this._debug("max retries reached",this._retryCount,">=",s);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!k(a))throw Error("No valid WebSocket class provided");this._wait().then((function(){return e._getNextUrl(e._url)})).then((function(t){e._closeCalled||(e._debug("connect",{url:t,protocols:e._protocols}),e._ws=e._protocols?new a(t,e._protocols):new a(t),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout((function(){return e._handleTimeout()}),i))}))}}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new v(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new y(e,t,this))}catch(n){}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},e.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}(),E=O,L=n("5f87"),x=n("2f62"),T="https://api.zdcustom.com",S=T.replace(/https?/,/192.168.10/.test(T)?"ws":"wss"),N={data:function(){return{APP_WS_BASE_API:S}},destroyed:function(){this.closeWebSocket()},computed:Object(r["a"])(Object(r["a"])({},Object(x["c"])(["id"])),{},{websocketUrl:function(){return"/message/websocket"},websocketQuery:function(){return{userId:this.id}}}),methods:{getToken:L["a"],getWebsocketUrl:function(){return"".concat(S).concat(this.websocketUrl).concat(this.getWebsocketParams())},getWebsocketParams:function(){var e=this.websocketQuery,t=[];for(var n in e)t.push("".concat(n,"=").concat(e[n]));return"?".concat(t.join("&"),"&x-access-token=").concat(Object(L["a"])())},createWebsocket:function(){this.closeWebSocket(),this.websocket=new E(this.getWebsocketUrl()),this.websocket.onerror=this.websocketOnerror,this.websocket.onopen=this.websocketOnopen,this.websocket.onmessage=this.websocketOnmessage,this.websocket.onclose=this.websocketOnclose,this.websocket.onbeforeunload=this.websocketOnbeforeunload},websocketOnerror:function(){},websocketOnopen:function(){},websocketOnmessage:function(e){JSON.parse(e.data)},websocketOnclose:function(){},websocketOnbeforeunload:function(){this.closeWebSocket()},closeWebSocket:function(){var e,t;null===(e=this.websocket)||void 0===e||null===(t=e.close)||void 0===t||t.call(e)},visibilitychange:function(){var e,t=this;null===(e=this.visibilitychangeClose)||void 0===e||e.call(this),this.visibilitychangeClose=R({onShow:this.createWebsocket,onHide:this.closeWebSocket}),this.$once("hook:destroyed",(function(){t.visibilitychangeClose()}))}}};function R(e){var t=e.onShow,n=e.onHide,s="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null,o=s.replace(/hidden/i,"visibilitychange"),i=function(){document[s]?n():t()};return document.addEventListener(o,i),function(){document.removeEventListener(o,i)}}var j=n("dc00"),P={mixins:[N,j["a"]],components:{InfiniteScroll:p},props:{},data:function(){return{visible:!1,url:"/externalbusiness/messageService/messageSendRecord/list",query:{isRead:0,orderItems:[{asc:!1,column:"create_time"}]},xMenuType:"other",size:5,unReadNumber:0,infiniteScroll:!0}},watch:{isLinkWebsocket:{handler:function(e){e?this.createWebsocket():this.closeWebSocket()}},visible:function(e){e||(this.page=1,this.data=[]),e&&this.init()}},created:function(){var e=this;this.$bus.$on("changeUnReadNum",(function(t){e.unReadNumber=t}))},mounted:function(){this.firstLogin(),this.createWebsocket()},computed:Object(r["a"])({},Object(x["e"])({isLinkWebsocket:function(e){return e.user.isLinkWebsocket}})),methods:{load:function(){this.page++,this.init()},getLabel:function(){},clickAllRead:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.data.filter((function(e){var t=e.isRead;return 0===t})).map((function(e){var t=e.id;return t})),e.data.map((function(e){e.isRead=1})),n.length){t.next=5;break}return e.$message.warning("当前暂无未读消息"),t.abrupt("return");case 5:return t.next=7,readUpdateStatus({idList:n});case 7:s=t.sent,o=s.code,0===o?(e.$message.success("全部消息已读"),e.unReadNumber=0):e.$message.error("操作失败");case 10:case"end":return t.stop()}}),t)})))()},clickAllMessage:function(){this.visible=!1,this.$router.push({path:"/message/center"})},websocketOnmessage:function(e){var t=JSON.parse(e.data);for(var n in t)"forbidden"===n&&this.$store.commit("WEBSOCKET_STATUS_CHANGE",!1),"tradeType"===n&&this.$store.commit("EMIT_WEBSOCKET_EVENT",{type:t[n],message:t});this.init()},messageCardClick:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var s,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.isRead){n.next=9;break}return e.isRead=1,s=e.id,t.unReadNumber--,n.next=6,readUpdateStatus({idList:[s]});case 6:o=n.sent,i=o.code,t.judge(i);case 9:case"end":return n.stop()}}),n)})))()},judge:function(e){0!==e&&this.$message.error("操作失败")},firstLogin:function(){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,firstLoginMessage();case 2:case"end":return e.stop()}}),e)})))()},initCallBack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.page;this.unReadNumber=null===t||void 0===t?void 0:t.total}}},W=P,M=(n("2cb5"),n("edde"),Object(h["a"])(W,s,o,!1,null,"e60b0f4e",null));t["default"]=M.exports}}]);